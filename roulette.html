<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üé° –†—É–ª–µ—Ç–∫–∞</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .wheel {
      width: 300px;
      height: 300px;
      border-radius: 50%;
      border: 10px solid #333;
      margin: 20px auto;
      position: relative;
      overflow: hidden;
    }
    .wheel canvas {
      width: 100%;
      height: 100%;
      display: block;
    }
    .pointer {
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 30px solid red;
    }
    #message {
      font-weight: bold;
      margin-top: 10px;
      color: #333;
      text-align: center;
    }
    #countdown {
      font-size: 1rem;
      color: #555;
      text-align: center;
      margin-top: 5px;
    }
    #timer {
      font-weight: bold;
      margin-left: 5px;
    }
    #legend {
      max-width: 300px;
      margin: 10px auto;
      font-size: 0.9rem;
    }
    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
    }
    .legend-color {
      width: 16px;
      height: 16px;
      border: 1px solid #000;
      margin-right: 8px;
    }
  </style>
</head>
<body>
  <main>
    <h1>üé° –†—É–ª–µ—Ç–∫–∞</h1>
    <p>–ë–∞–ª–∞–Ω—Å: <span id="balance">...</span> üç¨</p>

    <div>
      <label for="bet">–°—Ç–∞–≤–∫–∞:</label>
      <input type="number" id="bet" min="1" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É" />
      <button id="joinBtn">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
    </div>
    <div id="countdown">
      <!-- –ï—Å–ª–∏ nextSpin === null, —Å—é–¥–∞ –≤—Å—Ç–∞–≤–∏–º "–û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞‚Ä¶" -->
      –î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ø–∏–Ω–∞: <span id="timer">‚Äî</span> —Å–µ–∫
    </div>

    <div class="wheel">
      <canvas id="canvas" width="300" height="300"></canvas>
      <div class="pointer"></div>
    </div>

    <!-- –õ–µ–≥–µ–Ω–¥–∞: –∫–∞–∫–æ–π –∏–≥—Ä–æ–∫ –∫–∞–∫–æ–≥–æ —Ü–≤–µ—Ç–∞ -->
    <div id="legend"></div>

    <p id="message"></p>
    <button onclick="window.location.href='mainPage.html'">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
  </main>

  <script>
    const BASE_URL = 'https://fen4yaragithubio-production-9286.up.railway.app';

    let user = null;
    let players = [];           // –¢–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ (–¥–ª—è –∫–æ–ª–µ—Å–∞, –¥–æ –Ω–∞—á–∞–ª–∞ –∞–Ω–∏–º–∞—Ü–∏–∏)
    let spinPlayers = [];       // –°–Ω–∏–º–æ–∫ –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ –º–æ–º–µ–Ω—Ç —Å—Ç–∞—Ä—Ç–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
    let isAnimating = false;    // –§–ª–∞–≥, —á—Ç–æ –∏–¥—ë—Ç –∞–Ω–∏–º–∞—Ü–∏—è —Å–ø–∏–Ω–∞
    let nextSpinTimestamp = null;
    let countdownIntervalId = null;

    const balanceEl = document.getElementById('balance');
    const messageEl = document.getElementById('message');
    const joinBtn = document.getElementById('joinBtn');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const timerEl = document.getElementById('timer');
    const countdownContainer = document.getElementById('countdown');
    const legendEl = document.getElementById('legend');

    // –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è (ease-out cubic)
    function easeOut(t) {
      return 1 - Math.pow(1 - t, 3);
    }

    function showMessage(msg, color = '#333') {
      messageEl.textContent = msg;
      messageEl.style.color = color;
    }

    // –†–∏—Å—É–µ–º –∫–æ–ª–µ—Å–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–∞—Å—Å–∏–≤–∞ { username, bet, color }
    function drawWheelByList(list) {
      ctx.clearRect(0, 0, 300, 300);
      if (list.length === 0) return;

      const totalBet = list.reduce((s, p) => s + p.bet, 0);
      let startAngle = 0;

      list.forEach(p => {
        const sliceAngle = (p.bet / totalBet) * 2 * Math.PI;
        ctx.beginPath();
        ctx.moveTo(150, 150);
        ctx.arc(150, 150, 150, startAngle, startAngle + sliceAngle);
        ctx.fillStyle = p.color;
        ctx.fill();
        startAngle += sliceAngle;
      });

      renderLegend(list);
    }

    // –†–∏—Å—É–µ–º –ª–µ–≥–µ–Ω–¥—É (—Ü–≤–µ—Ç + –∏–º—è + —Å—Ç–∞–≤–∫–∞)
    function renderLegend(list) {
      legendEl.innerHTML = '';
      list.forEach(p => {
        const item = document.createElement('div');
        item.className = 'legend-item';
        const colorBox = document.createElement('div');
        colorBox.className = 'legend-color';
        colorBox.style.backgroundColor = p.color;
        const text = document.createElement('div');
        text.textContent = `${p.username}: ${p.bet} üç¨`;
        item.appendChild(colorBox);
        item.appendChild(text);
        legendEl.appendChild(item);
      });
    }

    // === 1) –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –∏ (–µ—Å–ª–∏ –Ω–µ—Ç –∞–Ω–∏–º–∞—Ü–∏–∏) –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏—Ö –Ω–∞ –∫–æ–ª–µ—Å–µ
    async function fetchPlayersAndDraw() {
      try {
        const resp = await fetch(`${BASE_URL}/roulette/players`, { credentials: 'include' });
        if (!resp.ok) {
          if (resp.status === 401) throw new Error('–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
          else throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–≥—Ä–æ–∫–æ–≤');
        }
        const data = await resp.json();
        players = data.players;
        if (!isAnimating) {
          drawWheelByList(players);
        }
      } catch (err) {
        console.error('fetchPlayersAndDraw:', err);
      }
    }

    // === 2) –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —É —Å–µ—Ä–≤–µ—Ä–∞ nextSpin
    async function fetchNextSpin() {
      try {
        const resp = await fetch(`${BASE_URL}/roulette/next-spin`, { credentials: 'include' });
        if (!resp.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å next-spin');
        const data = await resp.json();

        // –°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—ë—Ç –ª–∏–±–æ { nextSpin: null } (–º–µ–Ω—å—à–µ 2 –∏–≥—Ä–æ–∫–æ–≤), –ª–∏–±–æ { nextSpin: <timestamp> }
        nextSpinTimestamp = data.nextSpin;

        // –ï—Å–ª–∏ –±—ã–ª –∑–∞–ø—É—â–µ–Ω —Å—Ç–∞—Ä—ã–π —Ç–∞–π–º–µ—Ä, —Å–±—Ä–æ—Å–∏–º –µ–≥–æ
        if (countdownIntervalId) {
          clearInterval(countdownIntervalId);
          countdownIntervalId = null;
        }

        if (nextSpinTimestamp) {
          // –ü–æ—è–≤–∏–ª—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π nextSpin ‚Üí –∑–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç
          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —à–∞–±–ª–æ–Ω "–î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ø–∏–Ω–∞: X —Å–µ–∫" (–≤–¥—Ä—É–≥ –º—ã –º–µ–Ω—è–ª–∏ —Ç–µ–∫—Å—Ç —Ä–∞–Ω–µ–µ)
          countdownContainer.innerHTML = '–î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ø–∏–Ω–∞: <span id="timer">‚Äî</span> —Å–µ–∫';
          // –ù–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç timer
          const newTimerEl = document.getElementById('timer');
          // –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –æ–±–Ω–æ–≤–ª—è—é—â—É—é –∑–Ω–∞—á–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–Ω–æ
          function updateTimer() {
            const now = Date.now();
            let diff = Math.floor((nextSpinTimestamp - now) / 1000);
            if (diff < 0) diff = 0;
            newTimerEl.textContent = diff;
            if (now >= nextSpinTimestamp) {
              clearInterval(countdownIntervalId);
              scheduleSpinAnimation();
            }
          }
          updateTimer();
          countdownIntervalId = setInterval(updateTimer, 500);
        } else {
          // nextSpin === null ‚Üí –∂–¥–µ–º –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞
          countdownContainer.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞‚Ä¶';
        }
      } catch (err) {
        console.error('fetchNextSpin:', err);
      }
    }

    // === 3) –ü–ª–∞–Ω–∏—Ä—É–µ–º –∞–Ω–∏–º–∞—Ü–∏—é, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –∏—Å—á–µ—Ä–ø–∞–µ—Ç—Å—è —Ç–∞–π–º–µ—Ä
    function scheduleSpinAnimation() {
      if (isAnimating || !nextSpinTimestamp) return;
      const now = Date.now();
      const delay = nextSpinTimestamp - now;
      if (delay <= 0) {
        animateSpin();
      } else {
        setTimeout(animateSpin, delay);
      }
    }

    // === 4) –ê–Ω–∏–º–∞—Ü–∏—è —Å–ø–∏–Ω–∞, ¬´–ø—Ä–∏–≤—è–∑–∞–Ω–Ω–∞—è¬ª –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –ø–æ–±–µ–¥–∏—Ç–µ–ª—è ===
    async function animateSpin() {
      if (isAnimating) return;

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º ¬´—Å–Ω–∏–º–æ–∫¬ª –æ—á–µ—Ä–µ–¥–∏ –≤ –º–æ–º–µ–Ω—Ç –∑–∞–ø—É—Å–∫–∞ —Å–ø–∏–Ω–∞
      spinPlayers = players.slice();

      // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫–æ–≤ –º–µ–Ω—å—à–µ –¥–≤—É—Ö ‚Äî –Ω–µ—Ç —Å–º—ã—Å–ª–∞ –∫—Ä—É—Ç–∏—Ç—å
      if (spinPlayers.length < 2) {
        showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è —Å–ø–∏–Ω–∞.', 'orange');
        isAnimating = false;
        nextSpinTimestamp = null;
        await fetchNextSpin();
        return;
      }

      isAnimating = true;
      showMessage('–ö—Ä—É—Ç–∏–º...', '#333');

      // –°—Ä–∞–∑—É –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–ø–æ–±–µ–¥–∏—Ç–µ–ª—å –∏ –æ–±—â–∏–π –±–∞–Ω–∫)
      let resData;
      try {
        const r = await fetch(`${BASE_URL}/roulette/result`, { credentials: 'include' });
        if (!r.ok) throw new Error('–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞');
        resData = await r.json();
      } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:', err);
        // –ï—Å–ª–∏ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, –æ—Ç–º–µ–Ω—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∏ –ø–µ—Ä–µ–∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º nextSpin
        isAnimating = false;
        nextSpinTimestamp = null;
        await fetchNextSpin();
        return;
      }
      const { winner, totalBet } = resData;

      // –í—ã—á–∏—Å–ª—è–µ–º, –≤ –∫–∞–∫–æ–º —Å–µ–∫—Ç–æ—Ä–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—å:
      // –ü—Ä–æ–π–¥—ë–º –ø–æ spinPlayers, –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞—è —É–≥–ª—ã
      const totalSum = spinPlayers.reduce((s, p) => s + p.bet, 0);
      let startAngle = 0;
      let winnerMidAngle = 0; // –∑–¥–µ—Å—å –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å —Å—Ä–µ–¥–Ω–∏–π —É–≥–æ–ª –ø–æ–±–µ–¥–∏—Ç–µ–ª—è

      for (let p of spinPlayers) {
        const sliceAngle = (p.bet / totalSum) * 2 * Math.PI;
        if (p.username === winner) {
          // –°—Ä–µ–¥–Ω–∏–π —É–≥–æ–ª —Å–µ–∫—Ç–æ—Ä–∞ = —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —É–≥–æ–ª + –ø–æ–ª–æ–≤–∏–Ω–∞ —É–≥–ª–∞
          winnerMidAngle = startAngle + sliceAngle / 2;
          break;
        }
        startAngle += sliceAngle;
      }

      // –£–∫–∞–∑–∞—Ç–µ–ª—å ¬´—Å—Ç—Ä–µ–ª–∫–∏¬ª –Ω–∞ –≤–µ—Ä—à–∏–Ω–µ –∫–æ–ª–µ—Å–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç canvas-—É–≥–ª—É = ‚àíœÄ/2.
      // –ù–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã _—Å—Ä–µ–¥–Ω–∏–π —É–≥–æ–ª_ —Å–µ–∫—Ç–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è (–Ω–∞—á–∞–ª—å–Ω–æ –∏–∑–º–µ—Ä—è–µ—Ç—Å—è –æ—Ç 0 = –≤–ø—Ä–∞–≤–æ)
      // –ø–æ—Å–ª–µ –≤—Ä–∞—â–µ–Ω–∏—è —Å–æ–≤–ø–∞–ª —Å ‚àíœÄ/2 (–≤–ø–∏—Å–∞–ª—Å—è –ø–æ–¥ –∫—Ä–∞—Å–Ω—É—é —Å—Ç—Ä–µ–ª–∫—É).
      // –ó–Ω–∞—á–∏—Ç –∏—Ç–æ–≥–æ–≤—ã–π –ø–æ–≤–æ—Ä–æ—Ç (rotation) –¥–æ–ª–∂–µ–Ω —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—Ç—å:
      //    (winnerMidAngle + rotation) ‚â° ‚àíœÄ/2  (mod 2œÄ)
      // ‚áí rotation = ‚àíœÄ/2 ‚àí winnerMidAngle + 2œÄ¬∑k. 
      // –í–æ–∑—å–º—ë–º k = 5 (—á—Ç–æ–±—ã –¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–æ–≤).
      const extraSpins = 5;
      const targetRotation = -Math.PI / 2 - winnerMidAngle + extraSpins * 2 * Math.PI;

      // –ù–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –∞–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è:
      const spinDuration = 3000; // 3 —Å–µ–∫—É–Ω–¥—ã
      const startTime = performance.now();

      function frame(now) {
        const elapsed = now - startTime;
        const t = Math.min(elapsed / spinDuration, 1);
        const eased = easeOut(t);
        const currentRotation = eased * targetRotation;

        // –†–∏—Å—É–µ–º ¬´–ø–æ–≤–æ—Ä–æ—Ç¬ª –∫–æ–ª–µ—Å–∞:
        ctx.save();
        ctx.clearRect(0, 0, 300, 300);
        ctx.translate(150, 150);
        ctx.rotate(currentRotation);
        ctx.translate(-150, -150);
        drawWheelByList(spinPlayers);
        ctx.restore();

        if (t < 1) {
          requestAnimationFrame(frame);
        } else {
          // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å: –æ–±—ä—è–≤–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è + —Å—É–º–º—É –≤—ã–∏–≥—Ä—ã—à–∞
          showMessage(`üéâ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${winner}, –≤—ã–∏–≥—Ä—ã—à: ${totalBet} üç¨`, 'green');

          // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ (–¥–µ–ª–∞–µ–º –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ /check-auth)
          fetch(`${BASE_URL}/check-auth`, { credentials: 'include' })
            .then(r2 => {
              if (!r2.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å');
              return r2.json();
            })
            .then(userData => {
              user.balance = userData.balance;
              balanceEl.textContent = user.balance;
            })
            .catch(err => console.error(err))
            .finally(async () => {
              // –ü–æ—Å–ª–µ —Å–ø–∏–Ω–∞: –æ—á–∏—â–∞–µ–º –æ—á–µ—Ä–µ–¥—å –ª–æ–∫–∞–ª—å–Ω–æ, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥–∏, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–æ–≤—ã–π nextSpin
              players = [];
              isAnimating = false;
              nextSpinTimestamp = null;
              await fetchNextSpin();
            });
        }
      }

      requestAnimationFrame(frame);
    }

    // === 5) –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã ===
    window.addEventListener('DOMContentLoaded', async () => {
      try {
        const resp = await fetch(`${BASE_URL}/check-auth`, { credentials: 'include' });
        if (!resp.ok) throw new Error('–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
        user = await resp.json();
        balanceEl.textContent = user.balance;

        // –ü–µ—Ä–≤—ã–π –∑–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä
        await fetchPlayersAndDraw();
        setInterval(fetchPlayersAndDraw, 2000);
        await fetchNextSpin();
      } catch (err) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ.');
        window.location.href = 'index.html';
      }
    });

    // === 6) –ù–∞–∂–∞—Ç–∏–µ ¬´–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è¬ª ===
    joinBtn.addEventListener('click', async () => {
      const betValue = parseInt(document.getElementById('bet').value);
      if (!betValue || betValue <= 0) {
        showMessage('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞!', 'red');
        return;
      }
      if (betValue > user.balance) {
        showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!', 'red');
        return;
      }

      try {
        const resp = await fetch(`${BASE_URL}/roulette/join`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ bet: betValue })
        });
        const data = await resp.json();
        if (!resp.ok) {
          throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ join');
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫–æ–ª–µ—Å–æ
        players = data.players;
        drawWheelByList(players);

        // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const check = await fetch(`${BASE_URL}/check-auth`, { credentials: 'include' });
        if (check.ok) {
          const upd = await check.json();
          user.balance = upd.balance;
          balanceEl.textContent = user.balance;
        }

        showMessage('–í—ã –≤ –∏–≥—Ä–µ. –ñ–¥—ë–º —Å–ø–∏–Ω–∞...', '#333');

        // –ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –∏–≥—Ä–æ–∫ –∑–∞—à—ë–ª, –∑–∞–Ω–æ–≤–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º nextSpin:
        // –≤–æ–∑–º–æ–∂–Ω–æ, –∏–º–µ–Ω–Ω–æ —Å–µ–π—á–∞—Å —Å–µ—Ä–≤–µ—Ä –ø–æ–º–µ–Ω—è–ª nextSpin —Å null –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è.
        await fetchNextSpin();
      } catch (err) {
        showMessage(err.message, 'red');
      }
    });
  </script>
</body>
</html>
